<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Seed Market Data</title>
</head>

<body>
    <h1>Seeding Market Data...</h1>
    <div id="status">Starting...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCSCj5PAkFr9Rl-yA2-qBeE4GacWoS63b0",
            authDomain: "fantasfs2026.firebaseapp.com",
            projectId: "fantasfs2026",
            storageBucket: "fantasfs2026.firebasestorage.app",
            messagingSenderId: "794313055029",
            appId: "1:794313055029:web:7ac9b30e0b603638dd8a7c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const initialData = [
            // Circoli
            { name: "Como", category: "Circolo", price: 5 },
            { name: "Lodi", category: "Circolo", price: 8 },
            { name: "Mantova", category: "Circolo", price: 2 },

            // Equipe
            { name: "Carlo", category: "Equipe", price: 3 },
            { name: "Pietro", category: "Equipe", price: 4 },
            { name: "Mauri", category: "Equipe", price: 5 },

            // Ospiti
            { name: "Eugenio", category: "Ospite", price: 10 }
        ];

        async function seed() {
            const status = document.getElementById('status');
            try {
                // Clear existing market data to avoid duplicates
                status.innerText += "\nClearing old data...";
                const colRef = collection(db, "market");
                const snapshot = await getDocs(colRef);
                const deletePromises = snapshot.docs.map(doc => deleteDoc(doc.ref));
                await Promise.all(deletePromises);
                status.innerText += " DONE.";

                // Add new data
                status.innerText += "\nAdding new data...";
                for (const item of initialData) {
                    await addDoc(colRef, item);
                    status.innerText += `\nAdded ${item.name} (${item.price})`;
                }

                status.innerText += "\n\nSUCCESS! Database updated.";
            } catch (error) {
                console.error(error);
                status.innerText += `\nERROR: ${error.message}`;
            }
        }

        seed();
    </script>
</body>

</html>